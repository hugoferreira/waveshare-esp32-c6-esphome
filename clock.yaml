substitutions:
  # Blue-themed colors
  # color_disp_bg: "0x3D5879"
  # color_label_dark: "0x4C6682"
  # color_label_light: "0xC2DFFF"

  # Red-themed colors
  color_disp_bg: "0x5B2E3D"
  color_label_dark: "0x5F3744"
  color_label_light: "0xFFAFC9"

esphome:
  name: esp32c6_lcd
  friendly_name: ESP32C6 LCD Demo

  on_boot:
    priority: 800
    then:
      - light.turn_on:
          id: lcd_backlight
          brightness: 50%

esp32:
  board: esp32-c6-devkitc-1
  variant: esp32c6
  flash_size: 8MB
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_ESPTOOLPY_FLASHSIZE_8MB: y

ota:
  platform: esphome
  password: !secret ota_password

logger:

api:
  port: 6053
  reboot_timeout: 15min

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

time:
  - platform: sntp
    id: sntp_time
    timezone: UTC

interval:
  - interval: 1s
    then:
      - lambda: |-
          auto now = id(sntp_time).now();
          if (!now.is_valid()) {
            lv_label_set_text(id(clock_label), "--:--:--");
            return;
          }
          char buffer[9];
          now.strftime(buffer, sizeof(buffer), "%H:%M:%S");
          lv_label_set_text(id(clock_label), buffer);

spi:
  clk_pin: GPIO7
  mosi_pin: GPIO6

# --- Backlight: BL is on GPIO22 via transistor on this board ---
output:
  - platform: ledc
    pin: GPIO22          # LCD_BL
    id: lcd_bl

light:
  - platform: monochromatic
    id: lcd_backlight
    name: "LCD Backlight"
    output: lcd_bl
    restore_mode: RESTORE_DEFAULT_ON   # turn BL on at boot

  - platform: esp32_rmt_led_strip
    id: status_led
    name: "Onboard RGB LED"
    pin: GPIO8
    num_leds: 1
    chipset: ws2812
    rgb_order: RGB
    gamma_correct: 2.8
    default_transition_length: 0.2s

# --- Display: MIPI SPI driver, ST7789V chip ---
display:
  - platform: mipi_spi
    id: main_display
    model: ST7789V

    # Geometry for Waveshare 1.47" 172x320 panel
    # Panel is 172x320 and offset depends on rotation
    dimensions:
      width: 320
      height: 172
      offset_width: 0
      offset_height: 34

    rotation: 270

    cs_pin: GPIO14         # LCD_CS
    dc_pin: GPIO15         # LCD_DC
    reset_pin: GPIO21      # LCD_RST

    spi_mode: MODE3        # this board wants mode 3
    data_rate: 10MHz       # if it fails try 5MHz
    color_order: bgr       # typical for ST7789; flip to rgb if colors are wrong
    color_depth: 16        # RGB565
    invert_colors: true

    # LVGL *must* own the drawing. No lambda here.
    auto_clear_enabled: false
    update_interval: never

#font:
#  - file: "gfonts://Geo"   # Or Orbitron, or any other Google Font
#    id: orbitron_20
#    size: 32

font:
  - file: "fonts/DSEG14Modern-Bold.ttf"
    id: lcd_52
    size: 52

lvgl:
  buffer_size: 25%        # ~27kB for 172x320@RGB565 â€“ fine for ESP32-C6
  color_depth: 16         # must match display

  # Global background & default text
  disp_bg_color: ${color_disp_bg}
  text_font: lcd_52

  # Not strictly required with a single display, but explicit is nice:
  displays:
    - main_display

  pages:
    - id: main_page
      bg_opa: TRANSP
      widgets:
        - label:
            align: CENTER
            text_color: ${color_label_dark}
            text: "00:00:00"
        - label:
            id: clock_label
            align: CENTER
            text_color: ${color_label_light}
            text: "12:34:56"
